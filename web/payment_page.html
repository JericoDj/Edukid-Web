<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save Card with Square - Sandbox</title>

    <!-- Include Square's Web Payments SDK -->
    <script type="text/javascript" src="https://sandbox.web.squarecdn.com/v1/square.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            // Replace with your actual Sandbox Application ID and Location ID
            const applicationId = 'sandbox-sq0idb-a-JbuDtx-cqSBty0e5d2kA';
            const locationId = 'L9H98R67G9F2Y';

            // Initialize the Square payments object
            const payments = Square.payments(applicationId, locationId);

            // Create and attach the card payment method
            const card = await payments.card();
            await card.attach('#card-container');

            // Handle form submission
            document.getElementById('payment-form').addEventListener('submit', async function (event) {
                event.preventDefault();

                // Tokenize the card details
                const result = await card.tokenize();

                if (result.status === 'OK') {
                    // If tokenization is successful, send the nonce/token back to the Flutter app
                    window.opener.postMessage(result.token, '*');
                    window.close(); // Close the payment tab after processing
                } else {
                    // Handle tokenization failure
                    console.error('Tokenization failed:', result.errors);
                }
            });
        });
    </script>
</head>
<body>
<!-- Payment Form -->
<form id="payment-form">
    <!-- Square Card Element Container -->
    <div id="card-container"></div>

    <!-- Button to Save Card -->
    <button type="submit">Save Card</button>
</form>
</body>
</html>
